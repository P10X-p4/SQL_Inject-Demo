<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake Bank: Advanced SQL Injection Game</title>
    <!-- Use Tailwind CSS for a modern, responsive design -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for the message box */
        #message-box {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }
        /* Page views are hidden by default and shown with JavaScript */
        .page-view {
            display: none;
        }
        .page-view.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-700 min-h-screen flex items-center justify-center p-4 text-white">

    <!-- Message Box for alerts/prompts -->
    <div id="message-box" class="bg-white p-6 rounded-2xl shadow-xl border-t-4 border-yellow-500 text-gray-800 w-full max-w-sm mx-auto">
        <h3 class="text-xl font-bold mb-4" id="message-title"></h3>
        <p class="mb-4" id="message-text"></p>
        <div class="flex justify-end">
            <button id="ok-btn" class="bg-yellow-500 text-white px-4 py-2 rounded-xl font-semibold hover:bg-yellow-600 transition-colors">OK</button>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="bg-gray-800 p-8 rounded-3xl shadow-2xl w-full max-w-xl mx-auto border border-gray-700">
        <h1 class="text-4xl font-extrabold text-white mb-6 text-center">InsecureBank.js</h1>
        
        <!-- Login/Register View -->
        <div id="login-view" class="page-view active">
            <h2 class="text-2xl font-bold mb-4 text-center">Login or Register</h2>
            <div class="space-y-4">
                <input type="text" id="login-username" placeholder="Username" class="w-full p-3 rounded-xl bg-gray-700 border border-gray-600 text-white focus:outline-none focus:border-yellow-500 transition-colors shadow-sm">
                <input type="password" id="login-password" placeholder="Password" class="w-full p-3 rounded-xl bg-gray-700 border border-gray-600 text-white focus:outline-none focus:border-yellow-500 transition-colors shadow-sm">
                
                <div class="flex justify-between gap-4 pt-2">
                    <button id="login-btn" class="flex-1 bg-yellow-500 text-gray-900 p-3 rounded-xl font-semibold hover:bg-yellow-600 transition-colors shadow-md">Login (Classic Attack)</button>
                    <button id="register-btn" class="flex-1 bg-purple-600 text-white p-3 rounded-xl font-semibold hover:bg-purple-700 transition-colors shadow-md">Register</button>
                </div>
            </div>
            
            <p class="text-center text-sm text-gray-400 mt-4">
                **Classic Attack Hint:** The login is vulnerable to SQL injection. Try to log in as `admin` without their password using a payload like `' || '1'=='1`.
            </p>

            <hr class="border-gray-700 my-8">

            <h2 class="text-2xl font-bold mb-4 text-center">Blind SQL Injection</h2>
            <div class="space-y-4">
                <input type="text" id="blind-username" placeholder="Target Username (e.g., 'admin')" class="w-full p-3 rounded-xl bg-gray-700 border border-gray-600 text-white focus:outline-none focus:border-yellow-500 transition-colors shadow-sm">
                <input type="text" id="blind-payload" placeholder="Payload (e.g., 'password' || LENGTH(password) == 16)" class="w-full p-3 rounded-xl bg-gray-700 border border-gray-600 text-white focus:outline-none focus:border-yellow-500 transition-colors shadow-sm">
                
                <div class="flex justify-center pt-2">
                    <button id="blind-btn" class="flex-1 bg-teal-500 text-gray-900 p-3 rounded-xl font-semibold hover:bg-teal-600 transition-colors shadow-md">Test Condition (Time-Based)</button>
                </div>
            </div>

            <p class="text-center text-sm text-gray-400 mt-4">
                **Time-Based Hint:** The app will have a significant delay if your `payload` evaluates to `true` for the target user. Use this to determine properties of their data, like the password length.
            </p>

            <hr class="border-gray-700 my-8">

            <h2 class="text-2xl font-bold mb-4 text-center">Union-Based SQL Injection</h2>
            <div class="space-y-4">
                <input type="text" id="union-user-id" placeholder="User ID to retrieve (e.g., '2')" class="w-full p-3 rounded-xl bg-gray-700 border border-gray-600 text-white focus:outline-none focus:border-yellow-500 transition-colors shadow-sm">
                
                <div class="flex justify-center pt-2">
                    <button id="union-btn" class="flex-1 bg-cyan-500 text-gray-900 p-3 rounded-xl font-semibold hover:bg-cyan-600 transition-colors shadow-md">Retrieve User Info</button>
                </div>
            </div>

            <p class="text-center text-sm text-gray-400 mt-4">
                **Union-Based Hint:** Inject a payload like `' UNION SELECT * FROM users WHERE id=2` into the User ID field to retrieve hidden data. In this JS simulation, you can use `|| users.find(u => u.id === 2)` to get the data.
            </p>
        </div>

        <!-- Banking Page View -->
        <div id="banking-view" class="page-view">
            <h2 class="text-2xl font-bold mb-4 text-center">Welcome, <span id="current-user"></span></h2>
            <p class="text-center text-gray-300">You are logged into your secure banking account.</p>
            <div class="bg-gray-700 p-6 rounded-xl mt-6">
                <p class="text-lg font-bold">Your Account Balance:</p>
                <p class="text-3xl font-extrabold text-green-400 mt-2">$ <span id="account-balance"></span></p>
            </div>
            <button id="logout-btn-banking" class="w-full bg-red-500 text-white p-3 rounded-xl font-semibold hover:bg-red-600 transition-colors shadow-md mt-6">Logout</button>
        </div>

        <!-- Admin Page View -->
        <div id="admin-view" class="page-view">
            <h2 class="text-2xl font-bold mb-4 text-center">Admin Dashboard</h2>
            <p class="text-gray-300 mb-4">All registered user data:</p>
            <div id="user-list" class="bg-gray-700 p-4 rounded-xl space-y-2 max-h-64 overflow-y-auto">
                <!-- User data will be inserted here by JavaScript -->
            </div>
            <button id="logout-btn-admin" class="w-full bg-red-500 text-white p-3 rounded-xl font-semibold hover:bg-red-600 transition-colors shadow-md mt-6">Logout</button>
        </div>
    </div>

    <script>
        // ===================================
        // JAVASCRIPT LOGIC
        // ===================================

        // Mock Database
        let users = [
            { id: 1, username: 'admin', password: 'supersecurepassword', isAdmin: true, balance: 9999999 },
            { id: 2, username: 'john.doe', password: 'password123', isAdmin: false, balance: 500 },
            { id: 3, username: 'jane.smith', password: 'mysecret', isAdmin: false, balance: 1250 },
            { id: 4, username: 'hacker', password: '123456', isAdmin: false, balance: 10 },
        ];

        let currentUser = null;

        // UI Element References
        const loginView = document.getElementById('login-view');
        const bankingView = document.getElementById('banking-view');
        const adminView = document.getElementById('admin-view');

        const loginUsernameInput = document.getElementById('login-username');
        const loginPasswordInput = document.getElementById('login-password');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const logoutBtnBanking = document.getElementById('logout-btn-banking');
        const logoutBtnAdmin = document.getElementById('logout-btn-admin');
        
        const blindUsernameInput = document.getElementById('blind-username');
        const blindPayloadInput = document.getElementById('blind-payload');
        const blindBtn = document.getElementById('blind-btn');

        const unionUserIdInput = document.getElementById('union-user-id');
        const unionBtn = document.getElementById('union-btn');

        const userListContainer = document.getElementById('user-list');

        // Message Box logic
        const messageBox = document.getElementById('message-box');
        const messageTitle = document.getElementById('message-title');
        const messageText = document.getElementById('message-text');
        const okBtn = document.getElementById('ok-btn');

        function showMessage(title, text) {
            messageTitle.innerText = title;
            messageText.innerText = text;
            messageBox.style.display = 'block';
        }

        okBtn.addEventListener('click', () => {
            messageBox.style.display = 'none';
        });

        // Function to switch between views
        function switchView(viewId) {
            const allViews = [loginView, bankingView, adminView];
            allViews.forEach(view => {
                view.classList.remove('active');
            });
            document.getElementById(viewId).classList.add('active');
        }

        // Simulates an insecure database query for login (Classic In-band Attack)
        function insecureLogin(username, password) {
            try {
                // The intentional vulnerability: concatenating user input directly into a query string
                const query = `users.find(user => user.username === '${username}' && user.password === '${password}')`;
                
                // Using eval() to execute the constructed query string
                const foundUser = eval(query);
                
                return foundUser;
            } catch (e) {
                // Return null if the eval() fails (e.g., malformed string from injection attempt)
                return null;
            }
        }

        // Simulates a Time-Based Blind SQL Injection
        function blindLoginCheck(username, payload) {
            return new Promise((resolve) => {
                const user = users.find(u => u.username === username);
                if (!user) {
                    return resolve(false);
                }

                try {
                    // Simulates a query with an injected condition that triggers a delay
                    // The payload is eval'd as a condition, not a direct login
                    const conditionQuery = `user && (${payload})`;
                    const conditionMet = eval(conditionQuery);

                    if (conditionMet) {
                        // If the condition is true, simulate a delay
                        const delaySeconds = 3;
                        showMessage('Processing...', `Condition is TRUE. Waiting for ${delaySeconds} seconds.`);
                        setTimeout(() => {
                            resolve(true);
                        }, delaySeconds * 1000);
                    } else {
                        // If the condition is false, respond immediately
                        showMessage('Processing...', 'Condition is FALSE. No delay.');
                        resolve(false);
                    }
                } catch (e) {
                    showMessage('Error', 'Invalid payload. Check your syntax.');
                    resolve(false);
                }
            });
        }
        
        // Simulates a Union-Based SQL Injection
        function unionBasedAttack(userId) {
            try {
                // The intentional vulnerability: the input is not sanitized.
                // The payload here is a simple string, but it's meant to represent a full injection.
                const query = `users.find(u => u.id === parseInt('${userId}'))`;
                
                // Using eval() to execute the constructed query string
                const foundUser = eval(query);

                if (foundUser) {
                    showMessage('Data Retrieved!', `Found user: Username: ${foundUser.username}, Password: ${foundUser.password}`);
                } else {
                    showMessage('Retrieval Failed', 'Could not find a user with that ID. Check your payload or the ID.');
                }
            } catch (e) {
                showMessage('Error', 'Invalid payload. Check your syntax.');
            }
        }

        // Login button handler (Classic Attack)
        loginBtn.addEventListener('click', () => {
            const username = loginUsernameInput.value;
            const password = loginPasswordInput.value;

            // Insecure login check
            const foundUser = insecureLogin(username, password);

            if (foundUser) {
                currentUser = foundUser;
                if (currentUser.isAdmin) {
                    renderAdminDashboard();
                    switchView('admin-view');
                } else {
                    renderBankingPage();
                    switchView('banking-view');
                }
            } else {
                showMessage('Login Failed', 'Invalid username or password. Or... maybe your injection attempt was flawed? 😉');
            }
        });

        // Blind attack button handler
        blindBtn.addEventListener('click', async () => {
            const username = blindUsernameInput.value;
            const payload = blindPayloadInput.value;
            
            // Show a message to indicate processing
            showMessage('Processing...', 'Sending payload...');
            
            // Wait for the blind check to complete
            const result = await blindLoginCheck(username, payload);
            
            if (result) {
                showMessage('Result', 'A significant delay was observed, meaning your condition was TRUE.');
            } else {
                showMessage('Result', 'No delay was observed, meaning your condition was FALSE.');
            }
        });

        // Union-based attack button handler
        unionBtn.addEventListener('click', () => {
            const userId = unionUserIdInput.value;
            unionBasedAttack(userId);
        });

        // Register button handler
        registerBtn.addEventListener('click', () => {
            const username = loginUsernameInput.value;
            const password = loginPasswordInput.value;

            if (username.length > 3 && password.length > 3) {
                // Check if username already exists
                const userExists = users.some(user => user.username === username);
                if (userExists) {
                    showMessage('Registration Failed', 'This username already exists.');
                } else {
                    const newUser = {
                        id: users.length + 1,
                        username: username,
                        password: password,
                        isAdmin: false,
                        balance: 100
                    };
                    users.push(newUser);
                    showMessage('Registration Successful', `User '${username}' created. You can now try to log in.`);
                }
            } else {
                showMessage('Registration Failed', 'Username and password must be at least 4 characters long.');
            }
        });

        // Logout handlers
        logoutBtnBanking.addEventListener('click', logout);
        logoutBtnAdmin.addEventListener('click', logout);

        function logout() {
            currentUser = null;
            loginUsernameInput.value = '';
            loginPasswordInput.value = '';
            blindUsernameInput.value = '';
            blindPayloadInput.value = '';
            unionUserIdInput.value = '';
            switchView('login-view');
        }
        
        // Render Functions
        function renderBankingPage() {
            document.getElementById('current-user').innerText = currentUser.username;
            document.getElementById('account-balance').innerText = currentUser.balance;
        }

        function renderAdminDashboard() {
            userListContainer.innerHTML = ''; // Clear previous list
            users.forEach(user => {
                const userElement = document.createElement('div');
                userElement.className = 'bg-gray-800 p-3 rounded-xl flex flex-col sm:flex-row justify-between items-start sm:items-center shadow-md';
                
                const userInfoHTML = `
                    <p class="font-bold">Username: <span class="text-yellow-400 font-normal">${user.username}</span></p>
                    <p class="font-bold">Password: <span class="text-yellow-400 font-normal">${user.password}</span></p>
                `;
                userElement.innerHTML = userInfoHTML;
                userListContainer.appendChild(userElement);
            });
        }

    </script>
</body>
</html>
